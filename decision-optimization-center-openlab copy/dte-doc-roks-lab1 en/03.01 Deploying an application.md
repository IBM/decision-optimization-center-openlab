**Exercise 2**

In this exercise, you will deploy a DOC-based capacity planning application - “Capacity Plan”. The goal of this application is to plan the execution of activities using the available resources.

The examples used in this exercise demonstrate key DOC functionalities and OpenShift features; you can find the sample application GitHub repository <a href=https://github.com/nmdoshi/doclab/releases/tag/db-gene-demo-capacity-planning-1.0.4 target="_blank">here</a>.

Red Hat OpenShift utilizes the **oc** command to extend the capabilities of the **kubectl** command. The **kubectl** command is provided as well to support existing workflows and scripts.  You can learn more about the **oc** and **kubectl** differences <a href=https://docs.openshift.com/container-platform/3.11/cli_reference/differences_oc_kubectl.html target="_blank">here</a>.

&nbsp;  
**Deploy Capacity Planning App**

1.	Launch the **OpenShift web console**, if not already running.

You should still have a browser tab open with the OpenShift web console from the previous exercise. Click the dropdown on **#IAMuser** on right-hand top corner. Click **Copy Login** command and new browser is opened. 

![](_attachments/Exercise2-step1-copy-login-command.png)


2.	On the new browser, click the **Display Token** hyperlink

![](_attachments/Exercise2-step2-display-token.png)


3.	**Access your cluster using OpenShift command line interface**

You will see login credentials for logging it on to terminal. Copy code under **Login in with this Token**

![](_attachments/Exercise2-step3-login-in-with-this-token.png)

4.	**Paste the login command** you copied from the Web UI into the lab terminal window. You can paste it using the right mouse and select paste from the menu or the paste keyboard shortcut for your operating system. The command will look similar to this:
```
oc login ##OPENSHIFT.dashboardUrl## --token=r0Nco6NU5Le3g......
```

You should see a success message similar to this:

```
Logged into "##OPENSHIFT.dashboardUrl##" as "IAM#openlabs" using the token provided.

You have access to the following projects and can switch between them with 'oc project <projectname>':

  * default
    ibm-cert-store
    ibm-system
    kube-proxy-and-dns
    kube-public
    kube-service-catalog
    kube-system
    openshift
    openshift-ansible-service-broker
    openshift-console
    openshift-infra
    openshift-monitoring
    openshift-node
    openshift-template-service-broker
    openshift-web-console

Using project "default".
Welcome! See 'oc help' to get started.
```
Validate access to your cluster.

**Note: when you see commands in a black box with green text, you can execute these commands in the terminal window to the right several different ways:**

     1. Manually type the command in the terminal window
     2. Cut and paste from the instructions to the terminal window
     3. Click on the green text and it will automatically be copied from the instructions window to the terminal window

5.	Execute the command below to create a new project

```execute
oc-new-project doclab
```
Sample Output:

```
Now using project "doclab" on server "https://c106-e.us-south.containers.cloud.ibm.com:32590".

You can add applications to this project with the 'new-app' command. For example, try:

    oc new-app ruby~https://github.com/sclorg/ruby-ex.git

to build a new example application in Python. Or use kubectl to deploy a simple Kubernetes application:

    kubectl create deployment hello-node --image=gcr.io/hello-minikube-zero-install/hello-node
```

![](_attachments/Exercise2-step5-oc-new-project-command.png)

6.	Next step is to push the helm charts from the Github repo using the following command: 

```execute
helm repo add db-gene-demo-capacity-planning https://nmdoshi.github.io/doclab/
```
You should see a success message similar to this:

```
"db-gene-demo-capacity-planning" has been added to your repositories
```

7.	Check to confirm if the repo is pushed. 

```execute
helm repo list
```
Output:
```
NAME                          	URL                              
db-gene-demo-capacity-planning	https://nmdoshi.github.io/doclab/
```


8.	Install the application on red hat open shift cluster using the following command in terminal.

```execute
helm install my-release db-gene-demo-capacity-planning/db-gene-demo-capacity-planning
```
Output:
```
NAME: my-release
LAST DEPLOYED: Tue Aug  4 17:09:33 2020
NAMESPACE: doclab
STATUS: deployed
REVISION: 1
TEST SUITE: None
```
![](_attachments/Exercise2-step8-install-charts-redhat-cluster.png)

9.	Now, let’s go ahead and get the pods status using the following command

```execute
oc get pods
```

You should see output similar to:
```
NAME                                        READY   STATUS      RESTARTS   AGE
backend-service-1-deploy                    0/1     Completed   0          89s
backend-service-1-jdpbj                     1/1     Running     1          85s
capacity-planning-checker-worker-1-deploy   0/1     Completed   0          87s
capacity-planning-checker-worker-1-hn5xn    1/1     Running     0          84s
capacity-planning-engine-worker-1-deploy    0/1     Completed   0          89s
capacity-planning-engine-worker-1-kpt5c     1/1     Running     0          86s
data-service-1-6d2fw                        1/1     Running     1          85s
data-service-1-deploy                       0/1     Completed   0          89s
dbos-documentation-1-deploy                 0/1     Completed   0          88s
dbos-documentation-1-mm5bs                  1/1     Running     0          86s
dbos-master-1-deploy                        0/1     Completed   0          88s
dbos-master-1-qvzlj                         1/1     Running     0          84s
dbos-web-console-1-deploy                   0/1     Completed   0          88s
dbos-web-console-1-dqf29                    1/1     Running     0          84s
execution-service-1-deploy                  0/1     Completed   0          89s
execution-service-1-vskjh                   1/1     Running     1          86s
gateway-service-1-deploy                    0/1     Completed   0          88s
gateway-service-1-h7jxl                     1/1     Running     0          84s
keycloak-1-deploy                           0/1     Completed   0          91s
keycloak-1-f7c87                            1/1     Running     0          88s
mongo-1-deploy                              0/1     Completed   0          87s
mongo-1-smm7k                               1/1     Running     0          84s
postgres-1-deploy                           0/1     Completed   0          91s
postgres-1-jt67r                            1/1     Running     0          87s
rabbitmq-1-deploy                           0/1     Completed   0          91s
rabbitmq-1-n267d                            1/1     Running     0          87s
scenario-service-1-45slq                    1/1     Running     1          84s
scenario-service-1-deploy                   0/1     Completed   0          88s
web-1-deploy                                0/1     Completed   0          89s
web-1-wqx5w                                 1/1     Running     0          86s
```


10.	Go back to the **OpenShift web console**. Click on **Projects** - located on the left menu bar which list all the projects. Click **doclab** project.

![](_attachments/Exercise2-step10-openshift-project.png)

11.	You will see the project dashboard. Click **Networking >** and expand. then, click **Routes**.

![](_attachments/Exercise2-step11-networking-routes.png)

12.	To open your application, click the **URL** for gateway under **Routes**, or click the **link icon** in the graphic..

![](_attachments/Exercise2-step12-gateway-routes.png)

A new window or tab should open in your browser for your application.

13.	**Sign In** to your application. You can enter any strings for username and password, for instance test: test because the app is running in demo mode.

![](_attachments/Exercise2-step13-keycloak-db-gene-demo-capacity-planning.png)

The application is now up and running. To log in the application, use the following credentials 
- **Username:** gene_admin
- **Password:** gene

![](_attachments/Exercise2-step14-screen-after-login.png)


Congrats! You’ve deployed a Decision Optimization Capacity Planning app to OpenShift Container Platform using a Source to Image (S2I) method. You can learn more about the Source to Image (S2I) method <a href=https://docs.openshift.com/container-platform/4.3/builds/build-strategies.html#build-strategy-s2i_build-strategies target="_blank">here</a>.

**End Exercise 2 ___**

