<!DOCTYPE html>
<html>
    <head>
        <style>
            .messageCss {
                color: red;
            }
            
            .labelCss {
                padding-top: 0.2rem;
            }
            
            .bx--label {
                font-size: 0.9rem;
                font-weight: 400;
                letter-spacing: 0.32px;
                color: #393939;
                display: inline-block;
                vertical-align: baseline;
                margin-bottom: 0.5rem;
                line-height: 0rem;
                font-family: "IBM Plex Sans";
            }
            
            .bottom-margin-opportunity {
                margin-bottom: 1.25rem;
            }
            
            .bottom-margin {
                margin-bottom: 0.5rem;
            }
        </style>
        <script>
            function showOpportunity() {
                if (document.getElementById('opportunityRow') !== null) {
                    document.getElementById('opportunityRow').style.display = "block";
                }
            };
            function formReset() {
                if (typeof(Storage) !== "undefined") {
                    if (sessionStorage.getItem('isValid')) {
                        sessionStorage.removeItem('isValid');
                    }
                    let params = document.getElementsByName('param');
                    for (let i=0; i <params.length; i++) {
                        if (sessionStorage.getItem(params[i].id)) {
                            sessionStorage.removeItem(params[i].id);
                        }
                    }
                }
                if (document.getElementById('opportunityRow') !== null) {
                    document.getElementById('opportunityRow').style.display = "none";
                    document.getElementById('validationMessage').style.display = "none";
                    document.getElementById('customForm').reset();
                    document.getElementById('no').checked=true;
                }
            };
            function validateAndSetParams(evt) {
                //validate opportunity ID
                let salesConnect = new RegExp(/^\w{1,3}-\w{5,9}$/);
                let bpsalesConnect = new RegExp(/^BP1-\w{1,3}-\w{6,8}$/);
                let gaia = new RegExp(/^(\w{15,18})$/);
                if (typeof(Storage) !== "undefined") {
                    if (salesConnect.test(evt.target.value)) {
                      sessionStorage.setItem('isValid', 'yes');
                    } else if (bpsalesConnect.test(evt.target.value)) {
                      sessionStorage.setItem('isValid', 'yes');
                    } else if (gaia.test(evt.target.value)) {
                      sessionStorage.setItem('isValid', 'yes');
                    } else if (evt.target.value === '') {
                      sessionStorage.setItem('isValid', 'yes');
                    } else {
                      sessionStorage.setItem('isValid', 'no');
                    document.getElementById('validationMessage').style.display = "block";
                    }
                    sessionStorage.setItem(evt.target.id,  evt.target.value);
                }
            }
            function clearMessage(){
                if (document.getElementById('validationMessage')) {
                    document.getElementById('validationMessage').style.display = "none";
                }
            }
        </script>
    </head>

    <form id='customForm' onreset="formReset()">
        <div class="bx--grid mainCss">
            <div class="bx--row">
                <div class="bx--col-md-8 bottom-margin">
                    <label class="bx--label"> Do you have an Opportunity Id? </label>
                </div>
            </div>
            <div class="bx--row">
                <div class="bx--col-md-2">
                    <input type="radio" id="yes" name="opportunity" value="yes" onclick="showOpportunity()" />
                    <label for="yes" class="bx--label">Yes</label>
                </div>
                <div class="bx--col-md-2">
                    <input type="radio" id="no" name="opportunity" value="no" onclick="formReset()" checked />
                    <label for="no" class="bx--label">No</label><br>
                </div>
            </div>
        </div>
        <br>
        <div class="bx--grid" id="opportunityRow" style="display:none">
            <div class="bx--row">
                <div class="bx--col-md-6">
                    <div 
                      class="bx--form-item bx--text-input-wrapper">
                          <label for="opportunityId" class="bx--label bottom-margin-opportunity">Opportunity Id:</label>
                          <div class="bx--text-input__field-wrapper">
                            <input id="opportunityId" type="text"
                                onFocus="clearMessage()"
                                onBlur="validateAndSetParams(event)"
                                name="param"
                                class="bx--text-input" placeholder="Enter opportunity ID">
                          </div>
                    </div>
                </div>
                <div class="bx--col-md-4 labelCss">
                </div>
            </div>
            <div class="bx--row">
                <div class="bx--col-md-4 labelCss">
                    <label for="param-opportunityId" class="messageCss" style="display: none" id="validationMessage">Invalid Opportunity ID</label>
                </div>
                <div class="bx--col-md-4 labelCss">
                </div>
            </div>
        </div>
    </form>
</html>
